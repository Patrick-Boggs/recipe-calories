# Recipe Calories PWA — Handoff Document

## What Was Built

Rebuilt a Python desktop recipe calorie calculator (`RecipeApp/recipe_calculator.py`, 1397 lines, customtkinter GUI) into a **React PWA + Python serverless backend** deployed on Vercel.

**Live URL:** https://recipe-calories-ten.vercel.app
**GitHub:** https://github.com/Patrick-Boggs/recipe-calories
**Branch:** `master`

## Architecture

```
RecipeApp_React/
├── api/
│   ├── calculate.py          # Vercel Python serverless function (POST /api/calculate)
│   ├── recipe_logic.py       # Backend logic extracted from original app (lines 1-799)
│   └── nltk_data/            # Bundled NLTK data (required for ingredient parsing)
├── src/
│   ├── App.jsx               # Main app — state management, API calls, debug panel
│   ├── App.css
│   ├── main.jsx
│   ├── index.css             # All component styles
│   └── components/
│       ├── UrlInput.jsx      # URL input + Analyze button
│       ├── LoadingIndicator.jsx
│       ├── RecipeSummary.jsx # Title, servings, total/per-serving kcal
│       ├── IngredientTable.jsx # Ingredient breakdown with status dots
│       └── ScaleSelector.jsx # ½x, 1x, 2x, 3x, 4x (frontend-only scaling)
├── public/
│   ├── icon-192.png          # Placeholder PWA icons
│   └── icon-512.png
├── vercel.json               # Routing config
├── vite.config.js            # Vite + PWA plugin config
├── requirements.txt          # Python deps for serverless function
└── .env.example              # Documents required USDA_API_KEY env var
```

## Key Decisions & Gotchas

### Import path
`calculate.py` uses `from api.recipe_logic import calculate_recipe` — Vercel runs from the project root, not from inside `api/`.

### NLTK data bundling
`ingredient-parser-nlp` requires NLTK's `averaged_perceptron_tagger_eng` data. Vercel's filesystem is **read-only**, so NLTK can't download it at runtime. The data is pre-downloaded and committed in `api/nltk_data/`. `calculate.py` sets `NLTK_DATA` env var to that path before importing `recipe_logic`.

### API key
The USDA API key is stored as a Vercel environment variable (`USDA_API_KEY`), set for production, preview, and development. It is **not** in the source code. The key is: `moiGbWOpJ9Qi9Dfgivf83MIFtB87btfVL4DBcBwL`.

### Debug panel
`App.jsx` includes a `DebugDetails` component that shows HTTP status, request URL, and full server response (including Python tracebacks) when errors occur. This was added to aid debugging during deployment — can be removed later or hidden behind a flag.

### Diagnostic import wrapper
`calculate.py` wraps the `recipe_logic` import in try/except and returns the traceback as a JSON error if it fails. This was critical for diagnosing the NLTK issue. Can be simplified once stable.

## What Works

- Scraping recipes from allrecipes.com (tested with Chicken Tikka Masala)
- Full ingredient parsing, unit conversion, and USDA calorie lookup
- Recipe scaling (frontend-only — multiplies grams and kcal by scale factor)
- PWA manifest and service worker generated by vite-plugin-pwa
- Deployed and live on Vercel free tier

## What Hasn't Been Tested Yet

- Other recipe sites (some may need Cloudflare bypass via cloudscraper)
- PWA "Add to Home Screen" install flow on mobile
- Offline behavior (service worker caches app shell, but API calls need network)
- Edge cases: recipes with no servings, no ingredients found, very long ingredient lists

## Deployment

```bash
# From RecipeApp_React/
vercel --prod --yes          # Deploy to production
vercel env ls                # Check env vars
vercel logs <url>            # Check runtime logs
```

GitHub CLI (`gh`) and Vercel CLI (`vercel`) are both installed globally.

## Potential Next Steps

- **Test on more recipe sites** — the original app handles many edge cases; verify they work in the serverless environment
- **Replace placeholder PWA icons** — current ones are simple red circles on dark blue
- **Add authentication** — if needed to protect API quota (easy: just a check at top of `do_POST`)
- **Remove debug panel** — or hide behind a toggle once the app is stable
- **Connect Vercel to GitHub** — currently deploying via CLI; connecting via Vercel dashboard enables auto-deploy on push (requires adding a "Login Connection" at vercel.com)
- **Custom domain** — can be configured in Vercel dashboard
- **Vercel function timeout** — default is 10s on free tier; some recipes with many ingredients + USDA lookups may be slow. Consider adding a loading progress indicator that shows ingredient-by-ingredient progress (would need streaming or websockets)
